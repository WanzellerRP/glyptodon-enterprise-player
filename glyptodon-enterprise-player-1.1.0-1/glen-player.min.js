angular.module("app").controller("appController",["$scope",function(b){b.selectedRecording=null;b.playing=!1;b.error=!1;b.$on("glenPlayerLoading",function(){b.error=!1});b.$on("glenPlayerError",function(){b.selectedRecording=null;b.error=!0});b.$on("glenPlayerPlay",function(){b.playing=!0});b.$on("glenPlayerPause",function(){b.playing=!1})}]);angular.module("app",["file","player","templates-main"]);
angular.module("file").directive("glenFileChooser",[function(){return{restrict:"E",templateUrl:"modules/file/templates/fileChooser.html",transclude:!0,scope:{file:"\x3d"},controller:["$scope","$element",function(b,k){k.find('input[type\x3d"file"]').on("change",function(){var a=this.files;1===a.length&&b.$apply(function(){b.file=a[0]})})}]}}]);angular.module("file",["templates-main"]);
angular.module("player").directive("glenPlayer",["$injector",function(b){var k=b.get("SessionRecording");return{restrict:"E",templateUrl:"modules/player/templates/player.html",scope:{blob:"\x3d"},controller:["$scope","$element","$injector",function(a){a.recording=null;a.playbackPosition=0;a.operationText=null;a.operationProgress=0;a.seekPosition=null;var b=!1,c=!1;a.formatTime=function(a){a=Math.floor((a||0)/1E3);for(var b=[1,24,60,60],c=b.length-1;0<=c;c--){var d=b[c],e=a%d;b[c]=9<e?e:"0"+e;a=Math.floor(a/
d)}a=b.join(":");return/^[0:]*([0-9]{1,2}(?::[0-9]{2})+)$/.exec(a)[1]};a.beginSeekRequest=function(){a.recording&&!b&&(c=a.recording.isPlaying(),a.recording.pause());b=!0};a.commitSeekRequest=function(){a.recording&&b&&(a.seekPosition=null,a.operationText="Seeking to the requested position. Please wait...",a.operationProgress=0,a.cancelOperation=function(){a.recording.cancel();a.playbackPosition=a.seekPosition||a.playbackPosition},c&&a.recording.play(),a.recording.seek(a.playbackPosition,function(){a.operationText=
null;a.$evalAsync()}));b=!1};a.togglePlayback=function(){a.recording&&(a.recording.isPlaying()?a.recording.pause():a.recording.play())};a.$watch("blob",function(c){b=!1;a.playbackPosition=0;a.recording&&(a.recording.pause(),a.recording.abort());c?(a.recording=new k(c),a.recording.onload=function(){a.operationText=null;a.$emit("glenPlayerLoaded");a.$evalAsync()},a.recording.onerror=function(b){a.operationText=null;a.$emit("glenPlayerError",b);a.$evalAsync()},a.recording.onprogress=function(b,d){a.operationProgress=
d/c.size;a.$emit("glenPlayerProgress",b,d);a.$evalAsync()},a.recording.onplay=function(){a.$emit("glenPlayerPlay");a.$evalAsync()},a.recording.onpause=function(){a.$emit("glenPlayerPause");a.$evalAsync()},a.recording.onseek=function(b,c,d){a.recording.isPlaying()?a.playbackPosition=b:(a.seekPosition=b,a.operationProgress=c/d);a.$emit("glenPlayerSeek",b);a.$evalAsync()},a.operationText="Your recording is now being loaded. Please wait...",a.operationProgress=0,a.cancelOperation=function(){a.recording.abort();
a.operationText=null},a.$emit("glenPlayerLoading")):a.recording=null})}]}}]);
angular.module("player").directive("glenPlayerDisplay",[function(){return{restrict:"E",templateUrl:"modules/player/templates/playerDisplay.html",scope:{display:"\x3d"},controller:["$scope","$element",function(b,k){var a=k[0],l=k.find(".glen-player-display-container")[0],c=k.find(".glen-resize-sensor")[0],d=function(){if(b.display){var c=b.display.getWidth(),d=b.display.getHeight();c&&d&&b.display.scale(Math.min(a.offsetWidth/c,a.offsetHeight/d))}};b.$watch("display",function(a,b){b&&(l.innerHTML=
"",b.onresize=null);a&&(l.appendChild(a.getElement()),a.onresize=d,d())});c.onload=function(){c.contentDocument.defaultView.addEventListener("resize",d);d()}}]}}]);angular.module("player",["templates-main"]);
angular.module("player").directive("glenPlayerProgressIndicator",[function(){return{restrict:"E",templateUrl:"modules/player/templates/progressIndicator.html",scope:{progress:"\x3d"},controller:["$scope",function(b){b.percentage=0;b.barTransform=null;b.$watch("progress",function(k){k=k||0;b.percentage=Math.floor(100*k);b.barTransform="rotate("+(360*k-45)+"deg)"})}]}}]);
angular.module("player").factory("SessionRecording",[function(){var b=function a(b){var c=this,d=[],l=0,x=new a._PlaybackTunnel,n=new Guacamole.Client(x),e=-1,q=null,v=null,r=null,y=0,m=0,t=!1,p=null,A=function(a,d,h){if(!t||a!==b){var z=new Guacamole.Parser;z.oninstruction=d;var f=0,g=new FileReader;d=function(){if(!t||a!==b){if(2===g.readyState)try{z.receive(g.result)}catch(D){if(c.onerror)c.onerror(D.message);return}if(f>=a.size)h&&h();else{var d=a.slice(f,f+262144);f+=d.size;g.readAsText(d)}}};
g.onload=d;d()}},B=function(a){a=a.length;for(var b=a+3;10<=a;)b++,a=Math.floor(a/10);return b};n.connect();n.getDisplay().showCursor(!1);A(b,function(b,f){m+=B(b);for(var h=0;h<f.length;h++)m+=B(f[h]);if("sync"===b){b=parseInt(f[0]);f=new a._Frame(b,y,m);d.push(f);y=m;if(1===d.length||16384<=m-d[l].start&&5E3<=b-d[l].timestamp)f.keyframe=!0,l=d.length-1;if(c.onprogress)c.onprogress(c.getDuration(),m)}},function(){if(c.onload)c.onload()});var u=function(a){return 0===d.length?0:a-d[0].timestamp},
E=function f(a,b,c){if(a===b)return a;var g=Math.floor((a+b)/2),e=u(d[g].timestamp);return c<e&&g>a?f(a,g-1,c):c>e&&g<b?f(g+1,b,c):g},F=function(a,c){var f=d[a];A(b.slice(f.start,f.end),function(a,b){x.receiveInstruction(a,b)},function(){f.keyframe&&!f.clientState&&n.exportState(function(a){f.clientState=a});e=a;c&&c()})},C=function(a,b,l){w();var f=r={aborted:!1},g;for(g=a;0<=g;g--){var h=d[g];if(g===e)break;if(h.clientState){n.importState(h.clientState);e=a;break}}h=function G(){if(c.onseek&&e>
g)c.onseek(u(d[e].timestamp),e-g,a-g);f.aborted||(!f.aborted&&e<a?F(e+1,G):b())};l?window.setTimeout(h,l):h()},w=function(){r&&(r.aborted=!0,r=null)},H=function h(){if(e+1<d.length){var a=Math.max(d[e+1].timestamp-q+v-(new Date).getTime(),0);C(e+1,function(){h()},a)}else c.pause()};this.onseek=this.onpause=this.onplay=this.onprogress=this.onabort=this.onerror=this.onload=null;this.abort=function(){if(!t&&(t=!0,c.onabort))c.onabort()};this.getDisplay=function(){return n.getDisplay()};this.isPlaying=
function(){return!!q};this.getPosition=function(){return-1===e?0:u(d[e].timestamp)};this.getDuration=function(){return 0===d.length?0:u(d[d.length-1].timestamp)};this.play=function(){if(!c.isPlaying()&&e+1<d.length){if(c.onplay)c.onplay();q=d[e+1].timestamp;v=(new Date).getTime();H()}};this.seek=function(a,b){if(0!==d.length){c.cancel();var e=c.isPlaying();c.pause();p=function(){p=null;e&&(c.play(),e=null);b&&b()};C(E(0,d.length-1,a),p)}};this.cancel=function(){p&&(w(),p())};this.pause=function(){w();
if(c.isPlaying()){if(c.onpause)c.onpause();v=q=null}}};b._Frame=function(a,b,c){this.keyframe=!1;this.timestamp=a;this.start=b;this.end=c;this.clientState=null};b._PlaybackTunnel=function(){var a=this;this.connect=function(a){};this.sendMessage=function(a){};this.disconnect=function(){};this.receiveInstruction=function(b,c){if(a.oninstruction)a.oninstruction(b,c)}};return b}]);
angular.module("templates-main",[]).run(["$templateCache",function(b){b.put("modules/file/templates/fileChooser.html",'\x3clabel\x3e\n    \x3cng-transclude\x3e\x3c/ng-transclude\x3e\n    \x3cinput type\x3d"file"\x3e\n\x3c/label\x3e');b.put("modules/player/templates/player.html",'\x3c!-- Actual playback display --\x3e\n\x3cglen-player-display display\x3d"recording.getDisplay()"\n                     ng-click\x3d"togglePlayback()"\x3e\x3c/glen-player-display\x3e\n\n\x3c!-- Player controls --\x3e\n\x3cdiv class\x3d"glen-player-controls" ng-show\x3d"recording"\x3e\n\n    \x3c!-- Playback position slider --\x3e\n    \x3cinput class\x3d"glen-player-seek" type\x3d"range" min\x3d"0" step\x3d"1"\n           ng-attr-max\x3d"{{ recording.getDuration() }}"\n           ng-change\x3d"beginSeekRequest()"\n           ng-model\x3d"playbackPosition"\n           ng-on-change\x3d"commitSeekRequest()"\x3e\n\n    \x3c!-- Play button --\x3e\n    \x3cbutton class\x3d"glen-player-play"\n            title\x3d"Play"\n            ng-click\x3d"recording.play()"\n            ng-hide\x3d"recording.isPlaying()"\x3e\x3ci class\x3d"fas fa-play"\x3e\x3c/i\x3e\x3c/button\x3e\n\n    \x3c!-- Pause button --\x3e\n    \x3cbutton class\x3d"glen-player-pause"\n            title\x3d"Pause"\n            ng-click\x3d"recording.pause()"\n            ng-show\x3d"recording.isPlaying()"\x3e\x3ci class\x3d"fas fa-pause"\x3e\x3c/i\x3e\x3c/button\x3e\n\n    \x3c!-- Playback position and duration --\x3e\n    \x3cspan class\x3d"glen-player-position"\x3e\n        {{ formatTime(playbackPosition) }}\n        /\n        {{ formatTime(recording.getDuration()) }}\n    \x3c/span\x3e\n\n\x3c/div\x3e\n\n\x3c!-- Modal status indicator --\x3e\n\x3cdiv class\x3d"glen-player-status" ng-show\x3d"operationText"\x3e\n    \x3cglen-player-progress-indicator progress\x3d"operationProgress"\x3e\x3c/glen-player-progress-indicator\x3e\n    \x3cp\x3e{{ operationText }}\x3c/p\x3e\n    \x3cbutton class\x3d"glen-player-button" ng-show\x3d"cancelOperation"\n            ng-click\x3d"cancelOperation()"\x3e\x3ci class\x3d"fas fa-stop"\x3e\x3c/i\x3e Cancel\x3c/button\x3e\n\x3c/div\x3e');
b.put("modules/player/templates/playerDisplay.html",'\x3cdiv class\x3d"glen-player-display-container"\x3e\x3c/div\x3e\n\x3cobject class\x3d"glen-resize-sensor" type\x3d"text/html"\n        data\x3d"modules/player/templates/resize-sensor.html"\n        aria-hidden\x3d"true" alt\x3d""\x3e\x3c/object\x3e');b.put("modules/player/templates/progressIndicator.html","\x3cdiv class\x3d\"glen-player-progress-text\"\x3e{{ percentage }}%\x3c/div\x3e\n\x3cdiv class\x3d\"glen-player-progress-bar-container\" ng-class\x3d\"{\n        'past-halfway' : progress \x3e 0.5\n    }\"\x3e\n    \x3cdiv class\x3d\"glen-player-progress-bar\" ng-style\x3d\"{\n        '-webkit-transform' : barTransform,\n        '-moz-transform' : barTransform,\n        '-ms-transform' : barTransform,\n        '-o-transform' : barTransform,\n        'transform' : barTransform\n    }\"\x3e\x3c/div\x3e\n\x3c/div\x3e");
b.put("modules/player/templates/resize-sensor.html",'\x3c!DOCTYPE html\x3e\n\x3chtml lang\x3d"en"\x3e\n    \x3chead\x3e\n        \x3ctitle\x3eGlyptodon Enterprise - Session Recording Player (Resize Sensor)\x3c/title\x3e\n        \x3cmeta charset\x3d"utf-8"\x3e\n        \x3cmeta http-equiv\x3d"x-ua-compatible" content\x3d"IE\x3dedge"\x3e\n    \x3c/head\x3e\n    \x3cbody\x3e\x3c!--\n                                                    _/     sw+\n                                                    jm   _yWc\n                               ______.             _QQL  !Q?\n                          _amQQQQQQQQQQQga,        jQQQ, 7   .___,.\n                        _yQQQQQQQQQQQQQQQQQQw,     jQQQg    )QQWT?"\n                       jQQQQQQQQQQQQQQQQQQQQWQg,   ]QQQQm, ~~~-\n                      jQQQQQQQQQQQQQQQQQQQQQQQQQgwmQQQQQQ.., _,\n                     jQQQQQQQQQQQQQQQQQQQQQQQQQQWWP~-$QQQk -?wQga\n                    _QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ,  4QQQc   ?`?$\n                  .ayQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQm   "4QQ\n                 _yQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ[    -?(\n              .sjQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQa,__aaaaa,.\n             ayQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQWQWWQQQQW?9WQm,\n          _jQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQwyQWQm\n         _yQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQWQQQQ[\n         --"""^"^-`-` -"??TQWQQQQQQQQQQQQQQQQQQQP?"-~?9$QQQQQQQQQf\n                          .QQQQQQQQQ/  jQQQQQQQQg,         -~~~~-\n                           ^^^^^^^^^^  -^~^~^~^~^`\n    --\x3e\x3c/body\x3e\n\x3c/html\x3e')}]);
//# sourceMappingURL=glen-player.min.js.map